<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Arma2NETMySQL Plugin</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">

</head>
<body>

<center>
<h1>Arma2NETMySQL Plugin ReadMe</h1>
</center>

<h2>Contents</h2>
<ul>
<li><a href="#intro">Introduction</a></li>
<li><a href="#systemreqs">Requirements</a></li>
<li><a href="#howto">How To Use</a></li>
<li><a href="#known_issues">Known Issues</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#changelog">Changelog</a></li>
<li><a href="#license">License</a></li>
<li><a href="#thanks">Thanks To</a></li>
</ul>


<a name="intro"><h2>Introduction</h2></a>

<p>Links:</p>
<ul>
	<li><a href="https://github.com/firefly2442/Arma2NETMySQLPlugin">Arma2NETMySQLPlugin</a></li>
	<li><a href="https://github.com/firefly2442/Arma2NetMySQLPlugin-ExampleMission">Arma2NETMySQL Plugin Example Mission</a></li>
</ul>

<p>This program acts as an intermediary between Arma2 and a MySQL database.  It currently only supports MySQL.  It uses the
<a href="https://dev-heaven.net/projects/a2n">Arma2NET</a> wrapper system.  It is written in C#.  The program has to be run on the
same system as your Arma2 server, however, the MySQL database can be either local or remote.</p>

<p>History:</p>
<p>This program has had a long history.  Initially, the program used JayArma2Lib because DLL injections were the only way to
pass information between Arma2 and the outside.  Eventually, BIS added <a href="http://community.bistudio.com/wiki/callExtension">callExtension</a>
which allowed for a more structured (non-hacky) way to pass information.  JayArma2Lib switched to this and things continued.  Development
was done <a href="http://dev-heaven.net/projects/arma2-mysql">here</a> and an example mission was
<a href="http://dev-heaven.net/projects/arma2mysql-example">here</a>.  Technically, all that code should still work but the bad
part was all the formatting and ugly stuff that had to be done in game via the SQF scripting in order to get the data into a reasonable
format.  It involved iterating through strings and creating arrays and generally was still pretty hacky.  Then,
<a href="https://dev-heaven.net/projects/a2n">Arma2NET</a> came along and things got better.  This wrapper system allowed us to
return nice results back to Arma2 and not have to deal with all the formatting nonsense.  I ended up just copying the bits and pieces
that were needed from the past project and creating a new application.  Development is all done via the Github pages.  In addition,
the <a href="http://forums.bistudio.com/showthread.php?111484-ArmA2-Persistent-Database-Scripts-WIP">Persistent Database Scripts</a>
system as created by <a href="http://forums.bistudio.com/member.php?30502-KH-Jman">[KH]JMan</a> currently uses builds of this program
for saving data.
</p>

<img src="images/arma2mysql_graphic.jpg" />


<a name="systemreqs"><h2>Requirements</h2></a>

To run the application:
<ul>
	<li>You need a Windows server. (see known issues)</li>
	<li><a href="http://www.mysql.org" target="_blank">A MySQL server and database setup</a></li>
	<li><a href="http://www.mysql.com/downloads/connector/net/">MySQL Connector for .NET</a> The program has been
	successfully tested with version 6.5.4</li>
	<li><a href="http://www.microsoft.com/download/en/details.aspx?id=24872">Microsoft .NET Framework 4 Client Profile</a></li>
	<li>Arma2OA Beta version 87640 or later (full client or dedicated server)</li>
		<ul>
			<li>See <a href="https://dev-heaven.net/issues/31028">here</a> for a note about Windows dedicated servers and required files.</li>
		</ul>
	</li>
</ul>


<a name="howto"><h2>How To Use Arma2NETMySQL</h2></a>

<ul>
	<li>Edit the Databases.txt file (requires separate lines for each database, even if they're on the same host).</li>
		<ul>
			<li>This database text file stores usernames and passwords in plaintext.  Be very careful about who has access to this!  In addition,
			Arma2NETMySQL does not limit the actions that can be performed on the database.  For security reasons, create a username that is locked down
			and only has access to a single database.  We do not recommend connecting to the database as the root user.
			This is generally a really bad choice because this user has full access.
			We will not be responsible if something gets deleted!</li>
		</ul>
	<li>There are two ways to run MySQL queries with this plugin.  One is using MySQL stored procedures and the other
	is just to use straight queries.</li>
	<ol>
		<li>Stored Procedures:</li>
			<ul>
				<li>Setup a MySQL database and create some stored procedures to use.</li>
				<li>MySQL stored procedures are essentially just stored commands that run.  If you know basic SQL commands (SELECT, 
				INSERT, UPDATE) you should be fine.  These stored procedures can optionally have parameters that are passed which
				can then be used in the procedure.</li>
				<li>There are all kinds of tutorials on Google regarding MySQL stored procedures but the best one I've found so far with nice
				examples are these: <a href="http://www.mysqltutorial.org/getting-started-with-mysql-stored-procedures.aspx" target="_blank">Getting Started</a> and
				<a href="http://www.mysqltutorial.org/stored-procedures-parameters.aspx" target="_blank">Stored Procedure Parameters</a>.  The related tutorials links
				on the bottom of the page are also in the same series.</li>
				<li>Look at the <a href="https://github.com/firefly2442/Arma2NetMySQLPlugin-ExampleMission">example mission</a> which has an SQL file
				that sets up a database and some stored procedures for an example.</li>
				<li>Your SQF code will look something like this:
				<pre>_strCreate = format ["[u=%1,n=%2,a=%3,b=%4,c=%5,d=%6,e=%7]", _allWeapons select 0, _loadoutName, _allWeapons select 1,
								_allWeapons select 2, _allWeapons select 3, 
								_allWeapons select 4, _allWeapons select 5];
					_create = "Arma2Net.Unmanaged" callExtension format ["Arma2NETMySQL ['weapons', 'CreateNewLoadOut', '%1']", _strCreate];</pre>
				In this example, "weapons" is the database name.  "CreateNewLoadOut" is the MySQL stored procedure.  And all the parameters
				as part of the procedure are formatted appropriately and then passed along as the third argument.</li>
			</ul>
		<li>Straight queries:</li>
			<ul>
				<li>This is similar to what you're probably used to.  Commands like:
				<pre>SELECT * FROM table WHERE name = 'user'</pre></li>
				<li>Your SQF code will look something like this:
				<pre>_selectTest = "Arma2Net.Unmanaged" callExtension "Arma2NETMySQLCommand ['weapons', 'SELECT * FROM users LIMIT 3']";</pre>
				In this example, "weapons" is the database name.  The next portion is the entire MySQL command which you will need
				to create manually.  Note that the call names are different between running stored procedures versus straight queries.</li>
			</ul>
	</ol>
	<li>Run Arma2 and use this for your command line parameters (for the server which connects to the database):
		<pre>-mod=expansion\beta;expansion\beta\expansion;@CBA;@CBA_A2;@CBA_OA;@Arma2NET -arma2netdev</pre>
		<p>Alternatively, you can not use the -arma2netdev commandline parameter and just edit one of the settings file.
		Open up Settings.yaml and set "DisableSandboxing" to true.  Essentially, the reason why all of this is necessary
		is because only approved "signed" versions of plugins are accepted when the sandbox is active.  This allows third-party
		plugins to be run.</p>
		<p>Arma2 player clients do not need to do any of this.  They will interact with the Arma2 server and through SQF scripting, so you can
		pass the information from the database back to them or use it however you need.</p>
	</li>
	<li>Look at the <a href="https://github.com/firefly2442/Arma2NetMySQLPlugin-ExampleMission">example mission</a>
	for how to use the SQF scripting and get data inside the game.</li>
	<li>Use the array of arrays that are returned back.</li>
	<li>Enjoy.</li>
</ul>

<a name="known_issues"><h2>Known Issues</h2></a>

<p>Arma2NETMySQL Plugin uses the callExtension function, however, there are some
<a href="http://community.bistudio.com/wiki/Extensions#A_few_technical_considerations">technical considerations</a> as part of this.
</p>
<p>Returning results has a limit of 4000 characters.  If you try to run a MySQL query that will return a result longer than 4000 characters,
it will return the string "TooLong".  Then you know you will need to limit the number of results that are returned.  In MySQL,
you can use <a href="https://dev.mysql.com/doc/refman/5.0/en/select.html">the limit parameter</a>.  This is a limitation of
Arma2 so don't ask for this to be fixed.</p>

<a name="troubleshooting"><h2>Troubleshooting</h2></a>

<p>If you are getting a returned result of "Error" in Arma2, this means there's something wrong with your MySQL query.  Check
the logs to track down the problem.</p>
<p>Stuck?  First check the "logs" folder.  The plugin creates a new log file each time it's run.  Go into your root Arma2 folder where
the executable is, then find the "logs" folder.  If there are errors or things, they will show up there.  If you don't have
a logs folder or it's empty, this is a sign the plugin isn't running.  Try the second step:</p>
<p>Arma2NET also stores log files which are located here: <pre>C:\Users\Yourname\AppData\Local\Arma2NET</pre>
This will tell you if the plugin is loading appropriately.  If it's not, check your launcher and make sure that is all correct.</p>
<p>You can also check the RPT files generated by Arma 2.  These are located here: <pre>C:\Users\Yourname\AppData\Local\ArmA 2 OA</pre>
These can get very long so scroll all the way to the bottom to see the latest run.  This will tell you if you have an error in
your SQF scripting code or other such problems.  Note, these path locations are for Windows 7 (and Vista?) and may be different
for other versions of Windows.</p>

<p>If you found a bug, please create an issue ticket here:
<a href="https://github.com/firefly2442/Arma2NETMySQLPlugin">Github page</a>.</p>
<p>There is also <a href="http://forums.bistudio.com/showthread.php?128795-Arma2MySQL">a thread</a>
on the <a href="http://forums.bistudio.com">BIS forums</a> so if you're stuck, you can ask there.
The forums are preferred over emailing me because then the question/answer is available to
future people who have similar problems.</p>

<a name="changelog"><h2>Changelog</h2></a>

<ul>
<li>Version 0.1
	<ul>
		<li>Testing...</li>
	</ul>
</li>
</ul>

<a name="license"><h2>License</h2></a>

<p>Arma2NETMySQL is licensed under the <a href="license.txt" target="_blank">GPL version 3</a>.</p>

<a name="thanks"><h2>Thanks To</h2></a>

<ul>
<li>Thanks to Scott_NZ for <a href="https://dev-heaven.net/projects/a2n">Arma2NET</a></li>
<li>Thank you to Gnome, Robalo, Buehgler and all the guys over at <a href="http://www.alphasquad.net" target="_blank">AlphaSquad</a>.</li>
<li>Thanks to JMan at <a href="http://www.kellys-heroes.eu">Kellys Heroes</a>.</li>
<li>Thanks to all the testers.</li>
<li><a href="http://www.bistudio.com" target="_blank">Bohemia Interactive</a> for creating an awesome game and staying true to the community.</li>
</ul>

</body>
</html>
